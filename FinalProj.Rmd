---
title: "Insert Title"
author: "Insert Names"
date: "Spring 2018"
output: html_document
urlcolor: blue
---

```{r setup, include=FALSE, warning = FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## Final Project

```{r}
#Load libraries
library(readr)
library(rvest)
library(dplyr)
library(ggplot2)
```


```{r}
#Upload election integrity dataset
election_integrity <- read_csv("PEI US 2016 state-level (PEI_US_1.0) 16-12-2017.csv")

election_integrity_simple <- election_integrity %>%
  select(state, stateabbr, PEIIndexi, PEIIndex_rank)

```


```{r}
#Upload voter turnout dataset
voter_turnout <- read_csv("2016 November General Election - Turnout Rates.csv")
voter_turnout <- voter_turnout %>%
  select(State, "VEP.Highest.Office" = "X5", "VAP.Highest.Office" = "X6", "Total.Ballots.Counted.(Estimate)" = "Numerators", "Highest.Office" = "X8", "Voting.Eligible.Population.VEP" = "Denominators", "Voting.Age.Population.VAP" = "X10", "Total.Ineligible.Felons" = "X15", "Abbreviation" = "X17") %>%
  filter(!is.na(State) & State != "United States") %>%
  mutate(Voting.Eligible.Population.VEP = as.numeric(gsub(",", "", as.character(Voting.Eligible.Population.VEP))), Voting.Age.Population.VAP = as.numeric(gsub(",", "", as.character(Voting.Age.Population.VAP))), Total.Ineligible.Felons = as.numeric(gsub(",", "", as.character(Total.Ineligible.Felons)))) %>%
  mutate(Voters.Disenfranchised = Voting.Age.Population.VAP - Voting.Eligible.Population.VEP)

  
```

```{r}
#Scrape election results dataset
url <- "https://en.wikipedia.org/wiki/United_States_presidential_election,_2016"
tables <- url %>%
  read_html() %>%
  html_nodes(css = "table") 
election_results <- html_table(tables[[38]], fill = TRUE)
names(election_results) <- c("State", "Voting.Type", "Clinton.Number", "Clinton.Percent", "Clinton.Electoral", "Trump.Number", "Trump.Percent", "a", "b", "c", "d", "e", "f", "g", "h", "i", "j", "k", "l", "m", "n", "o", "p", "Abbreviation")
election_results <- election_results %>%
  select(State, Clinton.Percent, Trump.Percent, Abbreviation) %>%
  filter(State != "U.S. Total", State != "Nebraska, 1st", State != "Nebraska, 2nd", State != "Nebraska, 3rd", State != "Maine, 1st", State != "Maine, 2nd", Clinton.Percent != "%")  

election_results$State[election_results$State == "Maine (at-lg)"] <- "Maine"
election_results$Abbreviation[election_results$Abbreviation == "ME–a/l"] <- "ME"
election_results$State[election_results$State == "Nebraska (at-lg)"] <- "Nebraska"
election_results$Abbreviation[election_results$Abbreviation == "NE–a/l"] <- "NE"

election_results <- election_results %>% 
  mutate(Clinton.Percent = as.numeric(sub("%", "", as.character(Clinton.Percent))), Trump.Percent = as.numeric(sub("%", "", as.character(Trump.Percent)))) %>%
  mutate(Vote.Clinton = ifelse(Clinton.Percent - Trump.Percent > 0, "Yes", "No"))

```


```{r}
#Merge

integrity_turnout <- inner_join(election_integrity, voter_turnout, by = c("stateabbr" = "Abbreviation", "state" = "State"))

all <- inner_join(integrity_turnout, election_results, by = c("stateabbr" = "Abbreviation", "state" = "State"))
```

```{r}
#Exploratory Visuals ggplot stuff
ggplot(integrity_turnout, aes(x = log(Voters.Disenfranchised), y = PEIIndex_rank)) +
  geom_point()
ggplot(all, aes(x = log(Voters.Disenfranchised), y = PEIIndexi, color = Vote.Clinton)) +
  geom_point()
ggplot(all, aes(x = log(Voters.Disenfranchised), y = Trump.Percent)) +
  geom_point()
ggplot(all, aes(x = log(Voters.Disenfranchised), y = Clinton.Percent)) +
  geom_point()

```


```{r}
#Playing around with PCA
subset <- select(all, timely, waited)

#Exploratory PCA
pca1 = prcomp(subset, scale. = TRUE)

# create data frame with scores
scores = as.data.frame(pca1$x)

# plot of observations
ggplot(data = scores, aes(x = PC1, y = PC2, label = rownames(scores))) +
  geom_hline(yintercept = 0, colour = "gray65") +
  geom_vline(xintercept = 0, colour = "gray65") +
  geom_text(colour = "tomato", alpha = 0.8, size = 4) +
  ggtitle("PCA plot of USA States - Crime Rates")

```



